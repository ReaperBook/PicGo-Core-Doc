<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GUI插件开发 | PicGo-Core</title>
    <meta name="description" content="PicGo核心组件">
    <link rel="icon" href="https://raw.githubusercontent.com/Molunerfinn/test/master/picgo/New%20LOGO-150.png">
    
    <link rel="preload" href="/PicGo-Core-Doc/assets/css/0.styles.c58cb3ae.css" as="style"><link rel="preload" href="/PicGo-Core-Doc/assets/js/app.d9f84169.js" as="script"><link rel="preload" href="/PicGo-Core-Doc/assets/js/8.22f3f940.js" as="script"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/10.9f5ff146.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/11.a59e1338.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/12.15ec0510.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/13.33907fef.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/14.e64ffd81.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/2.1a3627a8.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/3.f453878d.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/4.0af0d7b8.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/5.77c8d8c9.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/6.cdcae461.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/7.8b352790.js"><link rel="prefetch" href="/PicGo-Core-Doc/assets/js/9.b25613b0.js">
    <link rel="stylesheet" href="/PicGo-Core-Doc/assets/css/0.styles.c58cb3ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/PicGo-Core-Doc/zh/" class="home-link router-link-active"><!----> <span class="site-name">PicGo-Core</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/PicGo-Core-Doc/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">插件开发指南</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/cli.html" class="nav-link">插件开发</a></li><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/gui.html" class="nav-link router-link-exact-active router-link-active">GUI插件开发</a></li><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/deploy.html" class="nav-link">插件测试与发布</a></li></ul></div></div><div class="nav-item"><a href="/PicGo-Core-Doc/zh/api/" class="nav-link">API列表</a></div> <a href="https://github.com/PicGo/PicGo-Core" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/PicGo-Core-Doc/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">插件开发指南</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/cli.html" class="nav-link">插件开发</a></li><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/gui.html" class="nav-link router-link-exact-active router-link-active">GUI插件开发</a></li><li class="dropdown-item"><!----> <a href="/PicGo-Core-Doc/zh/dev-guide/deploy.html" class="nav-link">插件测试与发布</a></li></ul></div></div><div class="nav-item"><a href="/PicGo-Core-Doc/zh/api/" class="nav-link">API列表</a></div> <a href="https://github.com/PicGo/PicGo-Core" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>插件开发指南</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/PicGo-Core-Doc/zh/dev-guide/cli.html" class="sidebar-link">插件开发</a></li><li><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html" class="active sidebar-link">GUI插件开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#guimenu" class="sidebar-link">guiMenu</a></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#guiapi" class="sidebar-link">guiApi</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#showinputbox-option" class="sidebar-link">showInputBox([option])</a></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#showfileexplorer-option" class="sidebar-link">showFileExplorer([option])</a></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#upload-file" class="sidebar-link">upload([file])</a></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#shownotificaiton-option" class="sidebar-link">showNotificaiton(option)</a></li></ul></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#事件" class="sidebar-link">事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#remove" class="sidebar-link">remove</a></li></ul></li><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PicGo-Core-Doc/zh/dev-guide/gui.html#uploader的名字" class="sidebar-link">Uploader的名字</a></li></ul></li></ul></li><li><a href="/PicGo-Core-Doc/zh/dev-guide/deploy.html" class="sidebar-link">插件测试与发布</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="gui插件开发"><a href="#gui插件开发" aria-hidden="true" class="header-anchor">#</a> GUI插件开发</h1> <h2 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h2> <p>GUI插件指的是运行在electron版本的<a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener noreferrer">PicGo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>里的插件。它支持绝大多数在普通插件里能实现的<a href="/PicGo-Core-Doc/zh/dev-guide/cli.html">功能</a>，还增加了额外的<code>guiApi</code>和其他的GUI特有的事件，让你的插件在PicGo里更加强大。</p> <p><img src="https://user-images.githubusercontent.com/12621342/50515434-bc9e8180-0adf-11e9-8c71-0e39973c06b1.png" alt></p> <p>PicGo在2.0版本之后支持的插件系统其实就是以PicGo-Core为底层核心实现的。在PicGo上传图片的过程中，你书写的插件（包括Uploader、Transformer等等）都会进入PicGo-Core的上传流程中，所以如果你写了一个CLI版本的插件，基本都能无缝运行在PicGo里。</p> <p>不过有的时候我们还需要一些额外的功能，比如：</p> <ul><li>相册里图片删除之后，对应的云端也删除图片</li> <li>通过url地址上传图片</li> <li>通过PicGo提供的上传接口，将某些MarkDown里的图片地址进行图床迁移</li></ul> <p>等等。这些操作或多或少需要额外的信息输入与交互，而不仅仅是依赖PicGo本身的上传区域来进行上传。所以针对GUI插件，PicGo提供了一些特殊的API来支持这些独立于常规上传流程之外的功能。</p> <div class="warning custom-block"><p class="custom-block-title">警告</p> <p>确保你已经阅读过非GUI版本的<a href="/PicGo-Core-Doc/zh/dev-guide/cli.html">插件开发</a>，之前提到的概念在GUI版本的插件概述里将不会重复。</p></div> <h2 id="guimenu"><a href="#guimenu" aria-hidden="true" class="header-anchor">#</a> guiMenu</h2> <p>guiMenu是PicGo提给给插件的自主控制权的主入口。它的作用是在PicGo的插件页面给予每个插件自主的菜单项，如下图：</p> <p><img src="https://i.loli.net/2019/01/12/5c39a2f60a32a.png" alt></p> <p>guiMenu是一个function，PicGo会传入<code>ctx</code>（picgo本身）方便开发者使用picgo自带的一些方法，最后应该返回一个 <strong>数组</strong>。</p> <p>每个menuItem只有两个属性，</p> <ul><li>一个是<code>label</code>，用于显示菜单文本。</li> <li>一个是<code>handle</code>，用于点击之后执行相应的操作。其中<code>handle</code>是一个<code>function</code>，推荐写成<code>async function</code>，方便控制流程。<code>handle</code>里会传入<code>ctx</code>和<code>guiApi</code>，<code>ctx</code>就是picgo本身，而<code>guiApi</code>后文会详细介绍。</li></ul> <p>代码示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开InputBox'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开FileExplorer'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>guiMenu应该在插件的<code>module.exports</code>里暴露出去。例如你已经写了一个普通的picgo插件如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handle</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> ctx<span class="token punctuation">.</span>input
  <span class="token keyword">let</span> output
  <span class="token comment">// do something</span>
  ctx<span class="token punctuation">.</span>output <span class="token operator">=</span> output
  <span class="token keyword">return</span> ctx
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>helper<span class="token punctuation">.</span>transformer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> handle <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    register<span class="token punctuation">,</span>
    transformer<span class="token punctuation">:</span> <span class="token string">'test'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么加入<code>guiMenu</code>应该是这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handle</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> ctx<span class="token punctuation">.</span>input
  <span class="token keyword">let</span> output
  <span class="token comment">// do something</span>
  ctx<span class="token punctuation">.</span>output <span class="token operator">=</span> output
  <span class="token keyword">return</span> ctx
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开InputBox'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开FileExplorer'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>helper<span class="token punctuation">.</span>transformer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> handle <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    register<span class="token punctuation">,</span>
    guiMenu<span class="token punctuation">,</span> <span class="token comment">// &lt;-- 在这里注册</span>
    transformer<span class="token punctuation">:</span> <span class="token string">'test'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="guiapi"><a href="#guiapi" aria-hidden="true" class="header-anchor">#</a> guiApi</h2> <p>上文介绍了每个菜单项都应该对应一个<code>handle</code>方法，用于执行点击菜单后的操作。其中传入的第一个参数为<code>ctx</code>，第二个参数为<code>guiApi</code>。</p> <p>guiApi目前提供了如下的api：</p> <ul><li><code>guiApi.showInputBox</code> 用于打开一个输入框</li> <li><code>guiApi.showFileExplorer</code> 用于打开文件浏览器</li> <li><code>guiApi.upload</code> 用于调用PicGo内部的上传方法上传</li> <li><code>guiApi.showNotificaiton</code> 用于调用系统级别的通知 (v2.0.1)</li></ul> <p>后续会逐渐增加。</p> <h3 id="showinputbox-option"><a href="#showinputbox-option" aria-hidden="true" class="header-anchor">#</a> showInputBox([option])</h3> <p>调用之后打开一个输入弹窗，可以用于接受用户输入。</p> <ul><li>option: Object || <code>undefined</code></li> <li>return: 返回一个Promise对象，resolve的值是用户输入的结果。所以推荐用<code>async await</code>的方式获取。</li></ul> <p>其中option是可选值，可以传入一个<code>{title, placeholder}</code>的对象，用于弹窗的标题和输入框的<code>placeholder</code>显示。</p> <p><img src="https://i.loli.net/2019/01/12/5c39aa4dab0b4.png" alt></p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开InputBox'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> guiApi<span class="token punctuation">.</span><span class="token function">showInputBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token punctuation">:</span> <span class="token string">'打开对话框'</span><span class="token punctuation">,</span>
          placeholder<span class="token punctuation">:</span> <span class="token string">'请输入文件地址'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="showfileexplorer-option"><a href="#showfileexplorer-option" aria-hidden="true" class="header-anchor">#</a> showFileExplorer([option])</h3> <p>调用之后打开一个文件浏览器，可以得到用户选择的文件（夹）路径。</p> <ul><li>option: Object || <code>undefined</code></li> <li>return: 返回一个Promise对象，resolve的值是用户选择的文件路径数组。所以推荐用<code>async await</code>的方式获取。</li></ul> <p>其中option是可选值，可以传入一个合法的electron的dialog的<a href="https://electronjs.org/docs/api/dialog#dialogshowopendialogbrowserwindow-options-callback" target="_blank" rel="noopener noreferrer">options对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，用于指定是否可多选，用于选择文件还是文件夹等等。</p> <p><img src="https://i.loli.net/2019/01/12/5c39aea61e80d.gif" alt></p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'打开文件浏览器'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> guiApi<span class="token punctuation">.</span><span class="token function">showFileExplorer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          properties<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'openFile'</span><span class="token punctuation">,</span> <span class="token string">'multiSelections'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="upload-file"><a href="#upload-file" aria-hidden="true" class="header-anchor">#</a> upload([file])</h3> <p>调用之后使用PicGo底层来上传，可以实现自动更新相册图片、上传成功后自动将URL写入剪贴板。</p> <ul><li>file: Array || <code>undefined</code></li> <li>return: 返回一个Promise对象，resolve的值是PicGo上传成功后的output值，是一个数组。所以推荐用<code>async await</code>获取。</li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>实际上如果通过上面的<code>showInputBox</code>获得输入项，或者<code>showFileExplorer</code>选中文件，再通过<code>upload</code>上传的话，也可以很好的达到上传的目的。
推荐还是书写Uploader或者Transformer等插件，来实现接管PicGo的上传流程。</p></div> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'独立上传'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> guiApi<span class="token punctuation">.</span><span class="token function">showFileExplorer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          properties<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'openFile'</span><span class="token punctuation">,</span> <span class="token string">'multiSelections'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        guiApi<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="shownotificaiton-option"><a href="#shownotificaiton-option" aria-hidden="true" class="header-anchor">#</a> showNotificaiton(option)</h3> <blockquote><p>v2.0.1开始支持</p></blockquote> <p>调用之后弹出系统通知窗口。</p> <ul><li>option: Object || <code>undefined</code></li> <li>return: undefined(无返回值)</li></ul> <p>其中option是必选值，需要提供<code>{title, body}</code>用于通知窗口的显示。</p> <p><img src="https://i.loli.net/2019/01/15/5c3db88042a0f.png" alt></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">guiMenu</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'显示通知'</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> guiApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        guiApi<span class="token punctuation">.</span><span class="token function">showNotificaiton</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
          body<span class="token punctuation">:</span> <span class="token string">'本提示来自插件'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="事件"><a href="#事件" aria-hidden="true" class="header-anchor">#</a> 事件</h2> <p>PicGo在一些情况下会触发一些事件，这些事件可以被插件监听从而实现一些额外的功能。你可以在你的插件的<code>register</code>里监听这些事件。</p> <h3 id="remove"><a href="#remove" aria-hidden="true" class="header-anchor">#</a> remove</h3> <p>当用户在相册里点击删除，并且确定的时候，将会触发<code>remove</code>事件：</p> <p><img src="https://i.loli.net/2019/01/12/5c39b3c8746cf.png" alt></p> <p><code>remove</code>事件会发送删除的图片列表（哪怕只有一张也是以数组格式传递），格式大概如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;20190112165042.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1660</span><span class="token punctuation">,</span>
    <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">932</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imgUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://yyyy/xxxx.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcyun&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;564b4cb8-3f1c-4af3-88b0-e9ba7f970468&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;new.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1648</span><span class="token punctuation">,</span>
    <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">936</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.gif&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imgUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://i.loli.net/2019/01/12/xxxx.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;smms&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8532567a-a307-426e-8d10-c54aecc2100d&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>你可以从中获取<code>type</code>值（上传的图床类型），文件名、URL、后缀等等信息。</p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'remove'</span><span class="token punctuation">,</span> files <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    register
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h2> <h3 id="uploader的名字"><a href="#uploader的名字" aria-hidden="true" class="header-anchor">#</a> Uploader的名字</h3> <p>如果你写了一个<code>Uploader</code>的插件，PicGo将会自动将其显示到图床列表里。你可以自定义一下这个图床要显示的名字，通过<code>name</code>选项来实现。如果你不提供这个<code>name</code>选项，那么PicGo将会显示Uploader注册的时候的<code>id</code>值。</p> <p><img src="https://i.loli.net/2019/01/12/5c39e91a73099.png" alt></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handle</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>helper<span class="token punctuation">.</span>uploader<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
      handle<span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'微博图床Plus'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    register<span class="token punctuation">,</span>
    uploader<span class="token punctuation">:</span> <span class="token string">'test'</span>  <span class="token comment">// Uploader的id</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果你的<code>Uploader</code>提供了<code>config</code>配置，那么在PicGo上也会相应显示出来。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/PicGo/PicGo-Core-Doc/edit/master/docs/zh/dev-guide/gui.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/PicGo-Core-Doc/zh/dev-guide/cli.html" class="prev">
          插件开发
        </a></span> <span class="next"><a href="/PicGo-Core-Doc/zh/dev-guide/deploy.html">
          插件测试与发布
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/PicGo-Core-Doc/assets/js/app.d9f84169.js" defer></script><script src="/PicGo-Core-Doc/assets/js/8.22f3f940.js" defer></script>
  </body>
</html>
